<!DOCTYPE html>
<html>
<head>
    <title>Interactive Image Overlay with Resizing</title>
    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-image: url('https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/GTCMHZSW8AAcKWE.jfif');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .container {
            text-align: center;
            position: relative;
            width: 75vw; 
        }

        .file-input-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border: 4px solid #000;
            border-radius: 20px;
            background-color: #84c8d5;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-bottom: 20px;
        }

        .file-input {
            display: none;
        }

        .file-input-container:hover {
            background-color: #e3ff88;
        }

        #overlayGallery {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            overflow-y: auto;
            max-height: 70vh;
            background-color: white;
            border: 2px solid #000;
            border-radius: 10px;
            padding: 10px;
        }

        #overlayGallery .overlay-set {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        #overlayGallery img {
            cursor: pointer;
            width: 80px;
            height: 80px;
            object-fit: cover;
            margin: 5px;
            border: 2px solid transparent;
            border-radius: 10px;
            background-color: white;
            padding: 5px;
        }

        #overlayGallery img.selected {
            border-color: #000;
        }

        #canvas {
            border: 1px solid black;
            margin-top: 10px;
        }

        .controls {
            margin-top: 10px;
            display: flex;
            justify-content: center;
        }

        .controls button {
            margin: 5px;
            padding: 10px;
        }

        .resize-handle {
            width: 10px;
            height: 10px;
            background-color: red;
            position: absolute;
            cursor: nwse-resize;
        }

        .overlay-box {
            position: absolute;
            border: 2px dashed black;
        }

        .separator {
            width: 100%;
            border-top: 2px solid black;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="file-input-container">
            <label for="imageInput">Upload Image to Overlay</label>
            <input type="file" id="imageInput" accept="image/*" class="file-input">
        </div>

        <div class="file-input-container">
            <label for="overlayInput">Upload Custom Overlay Image</label>
            <input type="file" id="overlayInput" accept="image/*" class="file-input">
        </div>

        <div id="overlayGallery">
            <div class="overlay-set" id="firstSet"></div>
            <div class="separator"></div>
            <div class="overlay-set" id="secondSet"></div>
        </div>

        <canvas id="canvas"></canvas>

        <div class="controls">
            <button id="rotateLeft">Rotate Left</button>
            <button id="rotateRight">Rotate Right</button>
            <button id="flipHorizontal">Flip Horizontal</button>
            <button id="flipVertical">Flip Vertical</button>
            <button id="saveImage">Save Image</button>
        </div>
    </div>

    <script>
        const imgInput = document.getElementById('imageInput');
        const ovInput = document.getElementById('overlayInput');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const firstSet = document.getElementById('firstSet');
        const secondSet = document.getElementById('secondSet');
        const saveBtn = document.getElementById('saveImage');

        let baseImg = new Image();
        let customOvImg = new Image();
        let currOvSrc = '', customOvSrc = '';

        let overlays = [];
        let selectedOverlay = null;

        let isDragging = false, isResizing = false;
        let startX, startY, initialX, initialY;

        imgInput.addEventListener('change', handleImage);
        ovInput.addEventListener('change', handleCustomOv);
        window.addEventListener('resize', drawCanvas);
        canvas.addEventListener('mousedown', handleMouseDown);
        canvas.addEventListener('mousemove', handleMouseMove);
        canvas.addEventListener('mouseup', handleMouseUp);

        function fetchOvGallery() {
            const firstSetUrls = [
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/drop%20out.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/ghost.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/hmpf.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/hopefull.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/issa%20ok.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/konfuzio.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/lizard.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/love%20me.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/naaah.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/ok.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/omg%20really.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/scared.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/scheme.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/smart.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/so%20what.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/thoughtfull.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/total%20fallout.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/war.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/wow.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/yea%20whateva.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/fck%20you.png'
            ];

            const secondSetUrls = [
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Russo.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Felicitas.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Sandra.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Elena.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Helvetia.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Candice.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Ludovica.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Maya.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Vinnie.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Anna.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Galicia.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Jeronima.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Rose.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Rock.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Seed.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Minimalosa.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Mina.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Leandra.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Lazarus.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Ellen.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Jutta.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Meredith.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Flavia.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Gaia.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Helena.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Lilly.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Margharita.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Tuula.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Micky.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Ozana.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Molly.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Leila.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Judith.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Buttercup.png',
                'https://raw.githubusercontent.com/IllegalArtifacts/Blume/main/Jane.png'
            ];

            firstSetUrls.forEach(url => {
                const img = document.createElement('img');
                img.src = url;
                img.onclick = () => selectOverlay(img.src);
                firstSet.appendChild(img);
            });

            secondSetUrls.forEach(url => {
                const img = document.createElement('img');
                img.src = url;
                img.onclick = () => selectOverlay(img.src);
                secondSet.appendChild(img);
            });
        }

        function selectOverlay(src) {
            const overlay = {
                img: new Image(),
                x: 50,
                y: 50,
                w: 100,
                h: 100,
                rot: 0,
                flipX: 1,
                flipY: 1,
                isSelected: false
            };
            overlay.img.src = src;
            overlay.img.onload = () => {
                overlays.push(overlay);
                selectedOverlay = overlay;
                drawCanvas();
            };
        }

        function handleImage(event) {
            const file = event.target.files[0];
            if (file) {
                baseImg.src = URL.createObjectURL(file);
                baseImg.onload = () => drawCanvas();
            }
        }

        function handleCustomOv(event) {
            const file = event.target.files[0];
            if (file) {
                customOvImg.src = URL.createObjectURL(file);
                customOvImg.onload = () => {
                    customOvSrc = customOvImg.src;
                    selectOverlay(customOvSrc);
                }
            }
        }

        function drawCanvas() {
            const containerWidth = document.querySelector('.container').offsetWidth * 0.75; // Scale down to 75%
            canvas.width = containerWidth; 
            canvas.height = (baseImg.naturalHeight / baseImg.naturalWidth) * canvas.width; 
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (baseImg.src) {
                ctx.drawImage(baseImg, 0, 0, canvas.width, canvas.height);
            }

            overlays.forEach(overlay => {
                ctx.save();
                ctx.translate(overlay.x + overlay.w / 2, overlay.y + overlay.h / 2);
                ctx.rotate(overlay.rot * Math.PI / 180);
                ctx.scale(overlay.flipX, overlay.flipY);
                ctx.drawImage(overlay.img, -overlay.w / 2, -overlay.h / 2, overlay.w, overlay.h);
                ctx.restore();
                
                if (overlay === selectedOverlay) {
                    drawBoundingBox(overlay);
                }
            });
        }

        function drawBoundingBox(overlay) {
            ctx.save();
            ctx.strokeStyle = 'blue';
            ctx.setLineDash([5, 5]);
            ctx.strokeRect(overlay.x, overlay.y, overlay.w, overlay.h);
            ctx.restore();
        }

        function handleMouseDown(event) {
            const mouseX = event.offsetX;
            const mouseY = event.offsetY;

            selectedOverlay = null;
            for (const overlay of overlays) {
                if (mouseX >= overlay.x && mouseX <= overlay.x + overlay.w &&
                    mouseY >= overlay.y && mouseY <= overlay.y + overlay.h) {
                    selectedOverlay = overlay;
                    break;
                }
            }

            if (selectedOverlay) {
                startX = mouseX;
                startY = mouseY;
                initialX = selectedOverlay.x;
                initialY = selectedOverlay.y;

                if (mouseX > selectedOverlay.x + selectedOverlay.w - 10 &&
                    mouseY > selectedOverlay.y + selectedOverlay.h - 10) {
                    isResizing = true;
                } else {
                    isDragging = true;
                }
            }
        }

        function handleMouseMove(event) {
            const mouseX = event.offsetX;
            const mouseY = event.offsetY;

            if (isDragging && selectedOverlay) {
                const dx = mouseX - startX;
                const dy = mouseY - startY;

                selectedOverlay.x = initialX + dx;
                selectedOverlay.y = initialY + dy;

                drawCanvas();
            }

            if (isResizing && selectedOverlay) {
                const dx = mouseX - startX;
                const dy = mouseY - startY;

		const scalingFactor = 3; // Adjusted scaling factor
                selectedOverlay.w = Math.max(50, initialX + dx - selectedOverlay.x);
                selectedOverlay.h = Math.max(50, initialY + dy - selectedOverlay.y);

                drawCanvas();
            }
        }

        function handleMouseUp() {
            isDragging = false;
            isResizing = false;
        }

        document.getElementById('rotateLeft').addEventListener('click', () => {
            if (selectedOverlay) {
                selectedOverlay.rot -= 15;
                drawCanvas();
            }
        });

        document.getElementById('rotateRight').addEventListener('click', () => {
            if (selectedOverlay) {
                selectedOverlay.rot += 15;
                drawCanvas();
            }
        });

        document.getElementById('flipHorizontal').addEventListener('click', () => {
            if (selectedOverlay) {
                selectedOverlay.flipX *= -1;
                drawCanvas();
            }
        });

        document.getElementById('flipVertical').addEventListener('click', () => {
            if (selectedOverlay) {
                selectedOverlay.flipY *= -1;
                drawCanvas();
            }
        });

        saveBtn.addEventListener('click', () => {
            const link = document.createElement('a');
            link.href = canvas.toDataURL('image/png');
            link.download = 'image_with_overlays.png';
            link.click();
        });

        fetchOvGallery();
    </script>
</body>
</html>
